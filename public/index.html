<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Eventos</title>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <style>
        div.cuadrado {
            position: relative;
            height: 256px;
            width: 256px;
            background-color: lightblue;
        }
        div.punto {
            left: 0px;
            top: 0px;
            height: 8px;
            width: 8px;
            position: absolute;
        }
    </style>
</head>
<body>
    <div class="cuadrado"></div>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        $(document).ready(function() {
            let cuadrado = $('div.cuadrado');

            let urlParams = new URLSearchParams(window.location.search);
            cuadrado.on("click", (e) => {
                let offset = cuadrado.offset();
                mover(urlParams.get("jugador"), e.pageX - offset.left, e.pageY - offset.top);
            });
            $(document).keydown((event) => {
                let punto = $('div.punto.' + urlParams.get("jugador"));
                let left = parseInt(punto.css("left").replace("px"));
                let top = parseInt(punto.css("top").replace("px"));
                if (event.which == 37) {
                    mover(urlParams.get("jugador"), left-8, top);
                }
                else if (event.which == 39) {
                    mover(urlParams.get("jugador"), left+8, top);
                }
            });

            let socket = io();
            socket.on('puntos', function(data) {
                data.forEach((punto) => {
                    pintar(punto);
                });
            })

            let mover = function(jugador, x, y) {
                let punto = {jugador: jugador, x: x, y: y};
                pintar(punto);
                socket.emit('punto', punto);
            }

            let pintar = (punto) => {
                let divPunto = $('div.punto.' + punto.jugador);
                if (divPunto.length == 0) {
                    cuadrado.append("<div class='punto {jugador}' />".replace("{jugador}", punto.jugador));
                    divPunto = $('div.punto.' + punto.jugador);
                    divPunto.css("background-color", punto.jugador);
                }
                divPunto.css("left", punto.x + "px");
                divPunto.css("top", punto.y + "px");
            }
            
        });
    </script>
</body>
</html>